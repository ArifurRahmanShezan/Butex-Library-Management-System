<div class="tw-max-w-full tw-p-6">
  <h2 class="tw-text-2xl tw-font-semibold tw-text-blue-700 tw-text-center tw-mb-6">
    Catalog Item Management
  </h2>

  <!-- Toolbar -->
  <div class="tw-flex tw-items-center tw-justify-between tw-mb-4">
    <h3 class="tw-text-lg tw-font-medium tw-text-gray-700">Catalog Items</h3>
    <button
      class="tw-bg-green-600 hover:tw-bg-green-700 tw-text-white tw-px-4 tw-py-2 tw-rounded-md tw-text-sm tw-font-medium"
      (click)="openModal()">
      + Add Item
    </button>
  </div>

  <!-- ✅ Table -->
  <div class="tw-overflow-x-auto tw-bg-white tw-rounded-lg tw-shadow">
    <table class="tw-w-full tw-border-collapse tw-text-sm">
      <thead class="tw-bg-gray-100 tw-text-gray-700 tw-font-medium">
        <tr>
          <th class="tw-px-4 tw-py-3 tw-text-left">ID</th>
          <th class="tw-px-4 tw-py-3 tw-text-left">Accession Number</th>
          <th class="tw-px-4 tw-py-3 tw-text-left">Barcode</th>
          <th class="tw-px-4 tw-py-3 tw-text-left">Location</th>
          <th class="tw-px-4 tw-py-3 tw-text-left">Status</th>
          <th class="tw-px-4 tw-py-3 tw-text-left">Acquisition Date</th>
          <th class="tw-px-4 tw-py-3 tw-text-left">Price (BDT)</th>
          <th class="tw-px-4 tw-py-3 tw-text-left">Acquisition Source</th>
          <th class="tw-px-4 tw-py-3 tw-text-left">Digital Content</th>
          <th class="tw-px-4 tw-py-3 tw-text-right">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngIf="catalogItems.length === 0">
          <td colspan="10" class="tw-text-center tw-text-gray-500 tw-py-6">
            No catalog items found.
          </td>
        </tr>
        <tr *ngFor="let item of catalogItems">
          <td class="tw-px-4 tw-py-2">{{ item.id }}</td>
          <td class="tw-px-4 tw-py-2">{{ item.accessionNumber }}</td>
          <td class="tw-px-4 tw-py-2">{{ item.barcode }}</td>
          <td class="tw-px-4 tw-py-2">{{ item.location }}</td>
          <td class="tw-px-4 tw-py-2">{{ item.status }}</td>
          <td class="tw-px-4 tw-py-2">{{ item.acquisitionDate || '—' }}</td>
          <td class="tw-px-4 tw-py-2">৳ {{ item.price }}</td>
          <td class="tw-px-4 tw-py-2">{{ item.acquisitionSource || '—' }}</td>
          <td class="tw-px-4 tw-py-2">
            <ng-container *ngIf="item.digitalContentUrls?.length; else noLinks">
              <a *ngFor="let link of item.digitalContentUrls" [href]="link" target="_blank"
                class="tw-text-blue-600 hover:tw-underline tw-block">Open</a>
            </ng-container>
            <ng-template #noLinks>—</ng-template>
          </td>
          <td class="tw-px-4 tw-py-2 tw-text-right">
            <button
              class="tw-bg-blue-600 hover:tw-bg-blue-700 tw-text-white tw-px-3 tw-py-1 tw-rounded-md tw-text-xs tw-mr-2"
              (click)="editItem(item)">
              Edit
            </button>
            <button class="tw-bg-red-600 hover:tw-bg-red-700 tw-text-white tw-px-3 tw-py-1 tw-rounded-md tw-text-xs"
              (click)="deleteItem(item)">
              Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- ✅ Compact Modal -->
<!-- Overlay -->
<div
  *ngIf="showModal"
  class="tw-fixed tw-inset-0 tw-bg-black/40 tw-backdrop-blur-sm tw-flex tw-items-center tw-justify-center tw-z-50"
>
  <!-- Modal -->
  <div
    class="tw-bg-white tw-rounded-2xl tw-shadow-2xl tw-w-[420px] tw-p-6 tw-relative tw-transition-all tw-duration-300 tw-ease-out tw-animate-fadeIn"
  >
    <!-- Always-visible Close Button -->
    <button
      (click)="closeModal()"
      class="tw-absolute tw-top-3 tw-right-3 tw-text-gray-400 hover:tw-text-red-600 tw-text-2xl tw-font-bold tw-leading-none tw-transition tw-duration-150"
      aria-label="Close modal"
    >
      &times;
    </button>

    <!-- Header -->
    <div class="tw-mb-5 tw-text-center">
      <h3 class="tw-text-xl tw-font-semibold tw-text-blue-700">
        {{ isEditing ? 'Edit Catalog Item' : 'Add Catalog Item' }}
      </h3>
    </div>

    <!-- Form -->
    <form (ngSubmit)="saveItem()" class="tw-space-y-4">
      <!-- Accession Number -->
      <div>
        <label class="tw-text-sm tw-font-medium tw-text-gray-700">Accession Number *</label>
        <input
          type="text"
          [(ngModel)]="item.accessionNumber"
          name="accessionNumber"
          required
          class="tw-w-full tw-mt-1 tw-border tw-border-gray-300 tw-rounded-lg tw-px-3 tw-py-2 tw-text-sm focus:tw-ring-2 focus:tw-ring-blue-500 focus:tw-border-blue-500 tw-transition"
        />
      </div>

      <!-- Barcode -->
      <div>
        <label class="tw-text-sm tw-font-medium tw-text-gray-700">Barcode *</label>
        <input
          type="text"
          [(ngModel)]="item.barcode"
          name="barcode"
          required
          class="tw-w-full tw-mt-1 tw-border tw-border-gray-300 tw-rounded-lg tw-px-3 tw-py-2 tw-text-sm focus:tw-ring-2 focus:tw-ring-blue-500 focus:tw-border-blue-500 tw-transition"
        />
      </div>

      <!-- Bibliographic Record -->
      <div>
        <label class="tw-text-sm tw-font-medium tw-text-gray-700">Bibliographic Record *</label>
        <select
          [(ngModel)]="item.bibliographicRecord.id"
          name="recordId"
          required
          class="tw-w-full tw-mt-1 tw-border tw-border-gray-300 tw-rounded-lg tw-px-3 tw-py-2 tw-text-sm tw-bg-white focus:tw-ring-2 focus:tw-ring-blue-500 focus:tw-border-blue-500 tw-transition"
        >
          <option value="">Select Record</option>
          <option *ngFor="let rec of records" [value]="rec.id">{{ rec.title }}</option>
        </select>
      </div>

      <!-- Location -->
      <div>
        <label class="tw-text-sm tw-font-medium tw-text-gray-700">Location *</label>
        <input
          type="text"
          [(ngModel)]="item.location"
          name="location"
          required
          class="tw-w-full tw-mt-1 tw-border tw-border-gray-300 tw-rounded-lg tw-px-3 tw-py-2 tw-text-sm focus:tw-ring-2 focus:tw-ring-blue-500 focus:tw-border-blue-500 tw-transition"
        />
      </div>

      <!-- Status -->
      <div>
        <label class="tw-text-sm tw-font-medium tw-text-gray-700">Status</label>
        <select
          [(ngModel)]="item.status"
          name="status"
          class="tw-w-full tw-mt-1 tw-border tw-border-gray-300 tw-rounded-lg tw-px-3 tw-py-2 tw-text-sm tw-bg-white focus:tw-ring-2 focus:tw-ring-blue-500 focus:tw-border-blue-500 tw-transition"
        >
          <option *ngFor="let s of statuses" [value]="s">{{ s }}</option>
        </select>
      </div>

      <!-- Two-column fields -->
      <div class="tw-grid tw-grid-cols-2 tw-gap-3">
        <div>
          <label class="tw-text-sm tw-font-medium tw-text-gray-700">Price</label>
          <input
            type="number"
            [(ngModel)]="item.price"
            name="price"
            min="0"
            class="tw-w-full tw-mt-1 tw-border tw-border-gray-300 tw-rounded-lg tw-px-3 tw-py-2 tw-text-sm focus:tw-ring-2 focus:tw-ring-blue-500 focus:tw-border-blue-500 tw-transition"
          />
        </div>
        <div>
          <label class="tw-text-sm tw-font-medium tw-text-gray-700">Acquisition Source</label>
          <input
            type="text"
            [(ngModel)]="item.acquisitionSource"
            name="acquisitionSource"
            class="tw-w-full tw-mt-1 tw-border tw-border-gray-300 tw-rounded-lg tw-px-3 tw-py-2 tw-text-sm focus:tw-ring-2 focus:tw-ring-blue-500 focus:tw-border-blue-500 tw-transition"
          />
        </div>
      </div>

      <!-- Buttons (Always Visible) -->
      <div class="tw-flex tw-justify-end tw-gap-3 tw-pt-4 tw-border-t tw-border-gray-200 tw-mt-4">
        <button
          type="button"
          (click)="closeModal()"
          class="tw-bg-gray-200 hover:tw-bg-gray-300 tw-text-gray-800 tw-px-4 tw-py-2 tw-rounded-lg tw-text-sm tw-font-medium tw-transition tw-duration-150"
        >
          Cancel
        </button>
        <button
          type="submit"
          class="tw-bg-green-600 hover:tw-bg-green-700 tw-text-white tw-px-4 tw-py-2 tw-rounded-lg tw-text-sm tw-font-medium tw-transition tw-duration-150"
        >
          {{ isEditing ? 'Update' : 'Save' }}
        </button>
      </div>
    </form>
  </div>
</div>
