<div class="tw-max-w-full tw-p-6">
  <h2 class="tw-text-2xl tw-font-semibold tw-text-blue-700 tw-text-center tw-mb-6">
    Catalog Item Management
  </h2>

  <!-- Toolbar -->
  <div class="tw-flex tw-items-center tw-justify-between tw-mb-4">
    <h3 class="tw-text-lg tw-font-medium tw-text-gray-700">Catalog Items</h3>
    <button
      class="tw-bg-green-600 hover:tw-bg-green-700 tw-text-white tw-px-4 tw-py-2 tw-rounded-md tw-text-sm tw-font-medium"
      (click)="openModal()"
    >
      + Add Item
    </button>
  </div>

  <!-- ✅ Table -->
  <div class="tw-overflow-x-auto tw-bg-white tw-rounded-lg tw-shadow">
    <table class="tw-w-full tw-border-collapse tw-text-sm">
      <thead class="tw-bg-gray-100 tw-text-gray-700 tw-font-medium">
        <tr>
          <th class="tw-px-4 tw-py-3 tw-text-left">ID</th>
          <th class="tw-px-4 tw-py-3 tw-text-left">Accession Number</th>
          <th class="tw-px-4 tw-py-3 tw-text-left">Barcode</th>
          <th class="tw-px-4 tw-py-3 tw-text-left">Location</th>
          <th class="tw-px-4 tw-py-3 tw-text-left">Status</th>
          <th class="tw-px-4 tw-py-3 tw-text-left">Acquisition Date</th>
          <th class="tw-px-4 tw-py-3 tw-text-left">Price (BDT)</th>
          <th class="tw-px-4 tw-py-3 tw-text-left">Acquisition Source</th>
          <th class="tw-px-4 tw-py-3 tw-text-left">Digital Content</th>
          <th class="tw-px-4 tw-py-3 tw-text-right">Actions</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngIf="catalogItems.length === 0">
          <td colspan="10" class="tw-text-center tw-text-gray-500 tw-py-6">
            No catalog items found.
          </td>
        </tr>

        <tr *ngFor="let item of catalogItems">
          <td class="tw-px-4 tw-py-2">{{ item.id }}</td>
          <td class="tw-px-4 tw-py-2">{{ item.accessionNumber }}</td>
          <td class="tw-px-4 tw-py-2">{{ item.barcode }}</td>
          <td class="tw-px-4 tw-py-2">{{ item.location }}</td>
          <td class="tw-px-4 tw-py-2">{{ item.status }}</td>
          <td class="tw-px-4 tw-py-2">{{ item.acquisitionDate || '—' }}</td>
          <td class="tw-px-4 tw-py-2">৳ {{ item.price }}</td>
          <td class="tw-px-4 tw-py-2">{{ item.acquisitionSource || '—' }}</td>
          <td class="tw-px-4 tw-py-2">
            <ng-container *ngIf="item.digitalContentUrls?.length; else noLinks">
              <a
                *ngFor="let link of item.digitalContentUrls"
                [href]="link"
                target="_blank"
                class="tw-text-blue-600 hover:tw-underline tw-block"
              >
                Open
              </a>
            </ng-container>
            <ng-template #noLinks>—</ng-template>
          </td>
          <td class="tw-flex tw-gap-2 tw-px-4 tw-py-3">
            <button
              class="tw-bg-blue-600 tw-text-white tw-rounded-md tw-px-3 tw-py-1 hover:tw-bg-blue-700"
              (click)="editItem(item)"
            >
              Edit
            </button>
            <button
              class="tw-bg-yellow-500 tw-text-white tw-rounded-md tw-px-3 tw-py-1 hover:tw-bg-yellow-600"
              (click)="openStatusModal(item)"
            >
              Update Status
            </button>
            <button
              class="tw-bg-red-600 tw-text-white tw-rounded-md tw-px-3 tw-py-1 hover:tw-bg-red-700"
              (click)="deleteItem(item)"
            >
              Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- ✅ Add/Edit Modal -->
<div
  *ngIf="showModal"
  class="tw-fixed tw-inset-0 tw-bg-black/40 tw-backdrop-blur-sm tw-flex tw-items-center tw-justify-center tw-z-50"
>
  <div class="tw-bg-white tw-rounded-2xl tw-shadow-2xl tw-w-[420px] tw-p-6 tw-relative">
    <button
      (click)="closeModal()"
      class="tw-absolute tw-top-3 tw-right-3 tw-text-gray-400 tw-text-2xl tw-font-bold"
    >
      &times;
    </button>

    <div class="tw-mb-5 tw-text-center">
      <h3 class="tw-text-xl tw-font-semibold tw-text-blue-700">
        {{ isEditing ? 'Edit Catalog Item' : 'Add Catalog Item' }}
      </h3>
    </div>

    <form (ngSubmit)="saveItem()" class="tw-space-y-3">
      <div>
        <label class="tw-text-sm tw-font-medium tw-text-gray-700">Accession Number *</label>
        <input
          type="text"
          [(ngModel)]="item.accessionNumber"
          name="accessionNumber"
          required
          class="tw-w-full tw-mt-1 tw-border tw-border-gray-300 tw-rounded-lg tw-px-3 tw-py-2 tw-text-sm focus:tw-ring-2 focus:tw-ring-blue-500"
        />
      </div>

      <div>
        <label class="tw-text-sm tw-font-medium tw-text-gray-700">Barcode *</label>
        <input
          type="text"
          [(ngModel)]="item.barcode"
          name="barcode"
          required
          class="tw-w-full tw-mt-1 tw-border tw-border-gray-300 tw-rounded-lg tw-px-3 tw-py-2 tw-text-sm focus:tw-ring-2 focus:tw-ring-blue-500"
        />
      </div>

      <div>
        <label class="tw-text-sm tw-font-medium tw-text-gray-700">Bibliographic Record *</label>
        <select
          [(ngModel)]="item.bibliographicRecord.id"
          name="recordId"
          required
          class="tw-w-full tw-mt-1 tw-border tw-border-gray-300 tw-rounded-lg tw-px-3 tw-py-2 tw-text-sm focus:tw-ring-2 focus:tw-ring-blue-500"
        >
          <option value="">Select Record</option>
          <option *ngFor="let rec of records" [value]="rec.id">{{ rec.title }}</option>
        </select>
      </div>

      <div>
        <label class="tw-text-sm tw-font-medium tw-text-gray-700">Location *</label>
        <input
          type="text"
          [(ngModel)]="item.location"
          name="location"
          required
          class="tw-w-full tw-mt-1 tw-border tw-border-gray-300 tw-rounded-lg tw-px-3 tw-py-2 tw-text-sm focus:tw-ring-2 focus:tw-ring-blue-500"
        />
      </div>

      <div>
        <label class="tw-text-sm tw-font-medium tw-text-gray-700">Status</label>
        <select
          [(ngModel)]="item.status"
          name="status"
          class="tw-w-full tw-mt-1 tw-border tw-border-gray-300 tw-rounded-lg tw-px-3 tw-py-2 tw-text-sm focus:tw-ring-2 focus:tw-ring-blue-500"
        >
          <option *ngFor="let s of statuses" [value]="s">{{ s }}</option>
        </select>
      </div>

      <div class="tw-grid tw-grid-cols-2 tw-gap-3">
        <div>
          <label class="tw-text-sm tw-font-medium tw-text-gray-700">Price</label>
          <input
            type="number"
            [(ngModel)]="item.price"
            name="price"
            min="0"
            class="tw-w-full tw-mt-1 tw-border tw-border-gray-300 tw-rounded-lg tw-px-3 tw-py-2 tw-text-sm focus:tw-ring-2 focus:tw-ring-blue-500"
          />
        </div>

        <div>
          <label class="tw-text-sm tw-font-medium tw-text-gray-700">Acquisition Source</label>
          <input
            type="text"
            [(ngModel)]="item.acquisitionSource"
            name="acquisitionSource"
            class="tw-w-full tw-mt-1 tw-border tw-border-gray-300 tw-rounded-lg tw-px-3 tw-py-2 tw-text-sm focus:tw-ring-2 focus:tw-ring-blue-500"
          />
        </div>
      </div>

      <div class="tw-flex tw-justify-end tw-gap-3 tw-pt-4 tw-border-t tw-border-gray-200">
        <button
          type="button"
          (click)="closeModal()"
          class="tw-bg-gray-200 hover:tw-bg-gray-300 tw-text-gray-800 tw-px-4 tw-py-2 tw-rounded-lg tw-text-sm"
        >
          Cancel
        </button>
        <button
          type="submit"
          class="tw-bg-green-600 hover:tw-bg-green-700 tw-text-white tw-px-4 tw-py-2 tw-rounded-lg tw-text-sm"
        >
          {{ isEditing ? 'Update' : 'Save' }}
        </button>
      </div>
    </form>
  </div>
</div>

<!-- ✅ Status Update Modal -->
<div
  *ngIf="showStatusModal"
  class="tw-fixed tw-inset-0 tw-bg-black/40 tw-flex tw-items-center tw-justify-center tw-z-50"
>
  <div class="tw-bg-white tw-rounded-2xl tw-shadow-2xl tw-w-[360px] tw-p-6 tw-relative">
    <button
      (click)="closeStatusModal()"
      class="tw-absolute tw-top-3 tw-right-3 tw-text-gray-400 tw-text-2xl tw-font-bold"
    >
      &times;
    </button>

    <h3 class="tw-text-lg tw-font-semibold tw-text-blue-700 tw-text-center tw-mb-4">
      Update Item Status
    </h3>

    <form (ngSubmit)="updateStatus()" class="tw-space-y-4">
      <div>
        <label class="tw-text-sm tw-font-medium tw-text-gray-700">Select New Status</label>
        <select
          [(ngModel)]="statusItem.status"
          name="status"
          required
          class="tw-w-full tw-mt-1 tw-border tw-border-gray-300 tw-rounded-lg tw-px-3 tw-py-2 tw-text-sm tw-bg-white focus:tw-ring-2 focus:tw-ring-blue-500"
        >
          <option *ngFor="let s of statuses" [value]="s">{{ s }}</option>
        </select>
      </div>

      <div class="tw-flex tw-justify-end tw-gap-3 tw-pt-3 tw-border-t tw-border-gray-200">
        <button
          type="button"
          (click)="closeStatusModal()"
          class="tw-bg-gray-200 hover:tw-bg-gray-300 tw-text-gray-800 tw-px-4 tw-py-2 tw-rounded-lg tw-text-sm"
        >
          Cancel
        </button>
        <button
          type="submit"
          class="tw-bg-yellow-500 hover:tw-bg-yellow-600 tw-text-white tw-px-4 tw-py-2 tw-rounded-lg tw-text-sm"
        >
          Update
        </button>
      </div>
    </form>
  </div>
</div>
