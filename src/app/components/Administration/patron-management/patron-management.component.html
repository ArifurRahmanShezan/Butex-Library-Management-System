<div class="container">
  <h2>Patron Creation & Management</h2>
  <div class="msg" *ngIf="message">{{ message }}</div>

  <div class="tabs">
    <div class="tab" [class.active]="activeTab==='patron'" (click)="setTab('patron')">Patrons</div>
    <div class="tab" [class.active]="activeTab==='department'" (click)="setTab('department')">Departments</div>
    <div class="tab" [class.active]="activeTab==='course'" (click)="setTab('course')">Courses</div>
    <div class="tab" [class.active]="activeTab==='category'" (click)="setTab('category')">Categories</div>
  </div>

  <!-- Patron Form -->
  <form *ngIf="activeTab==='patron'" (ngSubmit)="addPatron()">
    <label>Name *</label>
    <input type="text" [(ngModel)]="patron.name" name="patronName" required>

    <label>ID *</label>
    <input type="text" [(ngModel)]="patron.id" name="patronID" required>

    <label>Category *</label>
    <select [(ngModel)]="patron.category" name="patronCategory" required>
      <option value="">Select Category</option>
      <option *ngFor="let cat of categories">{{ cat }}</option>
    </select>

    <button type="submit">Submit</button>
  </form>

  <!-- Department Form -->
  <form *ngIf="activeTab==='department'" (ngSubmit)="addDepartment()">
    <label>Department Name *</label>
    <input type="text" [(ngModel)]="department.name" name="deptName" required>

    <label>Code *</label>
    <input type="text" [(ngModel)]="department.code" name="deptCode" required>

    <button type="submit">Submit</button>
  </form>

  <!-- Course Form -->
  <form *ngIf="activeTab==='course'" (ngSubmit)="addCourse()">
    <label>Course Name *</label>
    <input type="text" [(ngModel)]="course.name" name="courseName" required>

    <label>Course Code *</label>
    <input type="text" [(ngModel)]="course.code" name="courseCode" required>

    <label>Department *</label>
    <select [(ngModel)]="course.departmentId" name="courseDept" required>
      <option value="">Select Department</option>
      <option *ngFor="let dept of departments" [value]="dept.id">{{ dept.name }}</option>
    </select>

    <label>Description</label>
    <textarea [(ngModel)]="course.description" name="courseDescription"></textarea>

    <button type="submit">Submit</button>
  </form>

  <!-- Category Form -->
  <form *ngIf="activeTab==='category'" (ngSubmit)="addCategory()">
    <label>Category Name *</label>
    <input type="text" [(ngModel)]="category.name" name="categoryName" required>

    <label>Loan Limit *</label>
    <input type="number" [(ngModel)]="category.limit" name="loanLimit" required>

    <button type="submit">Submit</button>
  </form>

  <!-- ✅ Course List (visible only when Course tab active) -->
  <div *ngIf="activeTab === 'course'">
    <h3 style="margin-top: 20px;">Course List</h3>
    <table>
      <thead>
        <tr>
          <th>Course Name</th>
          <th>Code (Department)</th>
          <th>Created At</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let course of courses">
          <td>{{ course.name }}</td>
          <td>{{ course.code }} ({{ course.department?.name || 'N/A' }})</td>
          <td>{{ course.createdAt | date: 'medium' }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- ✅ Stats Table (hidden on course tab) -->
  <div *ngIf="activeTab !== 'course'">
    <h3 style="margin-top: 20px;">Patron Stats</h3>
    <table>
      <thead>
        <tr>
          <th>Name / Department / Category</th>
          <th>ID / Code / Limit</th>
          <th>Type</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of tableData">
          <td>{{ item.name }}</td>
          <td>{{ item.value }}</td>
          <td>{{ item.type }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
